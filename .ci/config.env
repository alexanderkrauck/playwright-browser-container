# Configuration for auto-deployment of Docker Compose projects
# This file is sourced by auto-deploy.sh

# Branches that trigger auto-deployment (space-separated)
# Default: main develop
DEPLOY_ON_BRANCHES="main master develop development staging"

# Whether to rebuild when only Dockerfile changes
REBUILD_ON_DOCKERFILE_CHANGE=true

# Number of old Docker images to keep (for rollback)
# Set to 0 to disable cleanup
KEEP_OLD_IMAGES=3

# Health check URLs (optional - will be auto-detected from docker-compose.yml if not specified)
# Space-separated list of URLs to check after deployment
# Example: HEALTH_CHECK_URLS="http://localhost:8000/health http://localhost:3000"
HEALTH_CHECK_URLS=""

# Timeout for health checks (seconds)
HEALTH_CHECK_TIMEOUT=30

# Enable verbose logging
VERBOSE_LOGGING=true

# Docker build options
DOCKER_BUILD_NO_CACHE=false
DOCKER_BUILD_PULL=true

# Container restart policy
RESTART_POLICY="unless-stopped"

# Network configuration (optional - auto-detected from docker-compose.yml if not specified)
DOCKER_NETWORK=""

# Volume configuration
PRESERVE_VOLUMES=true

# Notification settings (optional)
# SLACK_WEBHOOK_URL=""
# EMAIL_ON_FAILURE=""
# DESKTOP_NOTIFICATIONS=false

# Deployment strategy
# Options: rolling, recreate, blue-green
DEPLOYMENT_STRATEGY="recreate"

# Grace period before stopping old container (seconds)
STOP_GRACE_PERIOD=10

# Maximum deployment time before timeout (seconds)
DEPLOYMENT_TIMEOUT=300

# Log retention (days)
LOG_RETENTION_DAYS=30

# Enable deployment metrics
COLLECT_METRICS=false

# Custom environment variables for different branches
# These will be passed to docker-compose
# PROJECT_NAME is auto-detected from directory name
case "$BRANCH" in
    main|master)
        export COMPOSE_PROJECT_NAME="${PROJECT_NAME:-$(basename $(pwd))}-prod"
        export CONTAINER_NAME_SUFFIX=""
        ;;
    develop|development)
        export COMPOSE_PROJECT_NAME="${PROJECT_NAME:-$(basename $(pwd))}-dev"
        export CONTAINER_NAME_SUFFIX="-dev"
        ;;
    staging)
        export COMPOSE_PROJECT_NAME="${PROJECT_NAME:-$(basename $(pwd))}-staging"
        export CONTAINER_NAME_SUFFIX="-staging"
        ;;
    *)
        export COMPOSE_PROJECT_NAME="${PROJECT_NAME:-$(basename $(pwd))}-$BRANCH"
        export CONTAINER_NAME_SUFFIX="-$BRANCH"
        ;;
esac